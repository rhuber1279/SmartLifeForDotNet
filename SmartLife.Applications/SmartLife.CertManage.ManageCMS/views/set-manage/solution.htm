<style type="text/css">
    .accordion-header-selected
    {
        background-color:#f3f3f3 !important;
     }
     .panel-title{
         color:#575765 !important;
     }
</style>
<div class="easyui-accordion">
    <div id="cc" title="查询" data-options="iconCls:'icon-search'" style="overflow: auto;
        padding: 3px;">
        选择查看状态：<select id="queryState" class="easyui-combobox" style="width:80px" panelHeight="50px"><option value="normal">正常</option><option value="revoked">作废</option></select>
        <a href="javascript:void(0)" onclick="query_btn()" class="easyui-linkbutton">
        查询</a>
    </div>
</div>
<table id="cc-B11040604" style="width: 100%; height: 100%;">
    <tr>
        <td valign="top" style=" width: 200px;">
            <div id="toolbar-B11040604">
                <a behaviorcode="01" href="javascript:void(0)"
                        class="easyui-linkbutton" iconcls="icon-add" plain="true" onclick="add_solution()">新增</a>
                <a behaviorcode="02" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit"
                    plain="true" onclick="edit_solution()">编辑</a> <a behaviorcode="03" href="javascript:void(0)"
                        class="easyui-linkbutton" iconcls="icon-remove" plain="true" onclick="nullify_solution()">作废
                        </a>
            </div>
          <ul id="tree-B11040604">
          </ul>
        </td>
        <td style=" height:100%">
           <div id="toolbar2-B11040604">
                <a behaviorcode="01" href="javascript:void(0)"
                        class="easyui-linkbutton" iconcls="icon-add" plain="true" onclick="add_set()">新增</a>
                <a behaviorcode="02" href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit"
                    plain="true" onclick="edit_set()">编辑</a> <a behaviorcode="03" href="javascript:void(0)"
                        class="easyui-linkbutton" iconcls="icon-remove" plain="true" onclick="nullify_set()">
                        作废</a><a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-edit"
                            plain="true" onclick="add_subSet()">子集管理</a>
            </div>
            <table id="dg2-B11040604">
            </table>
        </td>
    </tr>
</table>
<div id="dlg-B11040604" class="easyui-dialog" style="width: 500px; height: 250px; padding: 10px;"
    closed="true" cache="false" buttons="#btn-B11040604">
    <form id="fm-B11040604" method="post" novalidate>
            <div class="fitem">
                <label>
                    方案编号:</label>
                <input name="SolutionId" id="solutionId-B11040604" class="easyui-validatebox" required="true" missingmessage="标准编号S开头,如‘S1’"/>
                <label>
                    方案名称:</label>
                <input name="SolutionName" class="easyui-validatebox" required="true" "/>
            </div>
            <div class="fitem">
                <label>
                    排序序号:</label>
                <input name="OrderNo" class="easyui-validatebox"/>
                <label>
                    默认集合:</label>
                <input name="DefaultSetId" id="DefaultSetId" class="easyui-validatebox"/>
            </div>
            <div class="fitem">
                <label>
                    描　　述:</label>
                <textarea name="Description" style="width: 370px;" maxlength="400"></textarea>
            </div>
        </form>
</div>
<!--集合-->
<div id="dlg2-B11040604" class="easyui-dialog" style="width: 500px; height: 240px; padding: 10px;"
    closed="true" cache="false" buttons="#btn2-B11040604">
    <input type="hidden" id="hid_solutionId" />
    <form id="fm2-B11040604" method="post" novalidate>
            <!--<input type="hidden" name="Id" id="id-B11040604" />-->
            <div class="fitem">
                <label>
                    集合编号　:</label>
                <input name="SetId"  id="setId-B11040604" class="easyui-validatebox" required="true"  missingmessage="编号以所属方案编号开头,如‘S101’"/>
                <label>
                    集合名称　:</label>
                <input name="SetName" class="easyui-validatebox" required="true"/>
            </div>
            <div class="fitem">
                <label>
                    方案编号　:</label>
                <input name="SolutionId" class="easyui-validatebox" required="true" disabled="disabled" />
                <label>
                    排序序号　:</label>
                <input name="OrderNo" class="easyui-validatebox"/>
            </div>
            <div class="fitem">
                <label>
                    小　部　件:</label>
                <input name="WidgetId" id="WidgetId" class="easyui-validatebox" />
                <label>
                    小部件设置:</label>
                <input name="WidgetOption" class="easyui-validatebox" />
            </div>
            <div class="fitem">
                <label>
                    描　　　述:</label>
                <textarea name="Description" style="width: 370px;" maxlength="400"></textarea>
            </div>
        </form>
</div>
<div id="btn-B11040604">
    <a href="javascript:void(0)" id="edit_btn" class="easyui-linkbutton" iconcls="icon-ok" onclick="save_solution()">
        确定</a> <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel"
            onclick="cancel()">取消</a>
</div>
<div id="btn2-B11040604">
    <a href="javascript:void(0)" id="A1" class="easyui-linkbutton" iconcls="icon-ok" onclick="save_set()">
        确定</a> <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel"
            onclick="cancel_set()">取消</a>
</div>
<!--<div id="dlg-search-B11040604" class="easyui-dialog" style="width: 420px; height: 200px;
    padding: 10px;" closed="true" cache="false" buttons="#btn-search-B11040604">
    <div class="ftitle">
    </div>
    <form id="fm-search-B11040604" method="post" novalidate>
    
    </form>
</div>
<div id="btn-search-B11040604">
    <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-search" onclick="exec()">
        查询</a> <a href="javascript:void(0)" class="easyui-linkbutton" onclick="clear()">清空</a>
    <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-cancel" onclick="quit()">关闭</a>
</div>-->

<script type="text/javascript">
    var defaultSetId; //默认集合
    var widgetId;

    $(function () {
        models[currentMenuCode] = {
            treeId: 'tree-' + currentMenuCode,
            gridId: 'dg-' + currentMenuCode,
            gridId2: 'dg2-' + currentMenuCode,
            toolbarId: 'toolbar-' + currentMenuCode,
            toolbarId2: 'toolbar2-' + currentMenuCode,
            dialogId: 'dlg-' + currentMenuCode,
            dialogId2: 'dlg2-' + currentMenuCode,
            dlgSearchId: 'dlg-search-' + currentMenuCode,
            fmSearchId: 'fm-search-' + currentMenuCode,
            btnSearchId: 'btn-search-' + currentMenuCode,
            formId: 'fm-' + currentMenuCode,
            formId2: 'fm2-' + currentMenuCode,
            buttonId: 'btn-' + currentMenuCode,
            pkId: 'solutionId-' + currentMenuCode,
            pk: 'SolutionId',
            pkId2: 'setId-' + currentMenuCode,
            pk2: 'SetId',
            getPKValueWhenAdd: function () {
                //                return window.contants.guidAutoGenerate;
            },
            changeFormDataBeforeSubmit: function (formData) {
                if (formData.DefaultSetId == "") formData.DefaultSetId = null;
                if (formData.OrderNo == "") formData.OrderNo = 0;
            },
            changeFormDataBeforeSubmit2: function (formData) {
                formData["SolutionId"] = $("#fm2-B11040604 input[name='SolutionId']").val();
                if (formData.OrderNo == "") formData.OrderNo = 0;
            },
            onBeforeDialogOpen: function () {
                getTo(baseCMSInvokeUrl + '/Pub/SetService/Query', { parms: $.toJSON(queryParams) }, function (result) {
                    defaultSetId = result.rows;
                }, { async: false });

                $("#DefaultSetId").combobox({
                    width: 152,
                    panelHeight: 80,
                    data: defaultSetId,
                    valueField: 'SetId',
                    textField: 'SetName',
                    editable: false
                });
            },
            onBeforeDialogOpen2: function () {
                $("#WidgetId").combobox({
                    width: 152,
                    panelHeight: 80,
                    required: true,
                    data: widgetId,
                    valueField: 'ItemId',
                    textField: 'ItemName',
                    editable: false
                });
            },
            onAfterDialogOpen2: function () {
                var sid = $("#hid_solutionId").val();
                if (sid != "" && sid != null) {
                    $("#fm2-B11040604 input[name='SolutionId']").val(sid);
                }
            },
            uiMode: 'list',
            entityName: '集合方案',
            entityName2: '集合',
            baseModelUrl: baseCMSInvokeUrl + '/Pub/SetSolutionService/',
            baseModelUrl2: baseCMSInvokeUrl + '/Pub/SetService/',
            defaultModel: { Status: 1 }
        };

        autosize("cc-" + currentMenuCode,-65);

        //默认集合查询
        var queryParams = new Object();
        queryParams.sort = 'OperatedOn';
        queryParams.order = 'desc';
        queryParams.Status = models[currentMenuCode].defaultModel.Status;

        /*用树代替故注释相关代码
        getTo(baseCMSInvokeUrl + '/Pub/SetService/Query', { parms: $.toJSON(queryParams) }, function (result) {
        defaultSetId = result.rows;
        }, { async: false });*/

        getTo(ajaxData_InvokeUrl + '/GetDictionaryItemWithExtendInfo/00024,[{"ExtendCol":"FieldLevel","ExtendColType":"i"}]', null, function (result) {
            var widget = [];
            for (var i = 0; i < result.length; i++) {
                if (result[i].ExtendInfos[0].ExtendValue == 1) {
                    widget.push({ "ItemId": result[i].ItemId, "ItemName": result[i].ItemName });
                }
            }
            widgetId = widget;
        }, { async: false });

        /*使用树代替
        $('#' + models[currentMenuCode].gridId).datagrid(easyuigrid_settings({
        title: "",
        fit: true,
        pagination: true,
        rownumbers: true,
        singleSelect: true,
        url: models[currentMenuCode].baseModelUrl + 'ListForEasyUIgrid',
        method: 'POST',
        toolbar: '#' + models[currentMenuCode].toolbarId,
        queryParams: {
        sort: 'OperatedOn',
        order: 'desc',
        instance: {
        'Status': models[currentMenuCode].defaultModel.Status
        }
        },
        onClickRow: function (idx, row) {
        query_set();
        },
        onDblClickRow: function (idx, row) {
        edit_solution(row);
        },
        columns: [[
        { field: 'CK', title: '', checkbox: true },
        { field: 'SolutionId', title: '方案编号', width: 60, align: 'center' },
        { field: 'SolutionName', title: '方案名称', width: 100, align: 'center' },
        { field: 'DefaultSetId', title: '默认集合', width: 80, align: 'center', formatter: easyuigrid_ajaxFormatter, vals: defaultSetId, textField: "SetName", valueField: "SetId", caseSensitive: false },
        { field: 'Description', title: '描述', width: 120, align: 'center' }
        ]],
        loader: easyuiLoader
        })).datagrid('getPager').pagination({ displayMsg: '显示 第 {from} 到 {to} 共 {total} 条' });*/

        initTree('easyUITree', models[currentMenuCode].treeId, {
            onClick: function (treeNode) {
                $("#hid_solutionId").val(treeNode.id);
                query_set();
            }, checkbox: true
        },
        function (d) {
            getTreeData('01$03$03', null, '{"Level":"0","WhereClause":" where level=0"}', d);
        },
        null,
        function (treeObj) {
            $('#' + models[currentMenuCode].gridId2).datagrid(easyuigrid_settings({
                title: "",
                fit: true,
                pagination: true,
                rownumbers: true,
                singleSelect: true,
                checkOnSelect: false,
                selectOnCheck:false,
                //url: models[currentMenuCode].baseModelUrl2 + 'ListForEasyUIgrid',
                method: 'POST',
                toolbar: '#' + models[currentMenuCode].toolbarId2,
                queryParams: {
                    sort: 'OperatedOn',
                    order: 'desc'
//                    instance: {
//                        'Status': models[currentMenuCode].defaultModel.Status
//                    }
                },
                onDblClickRow: function (idx, row) {
                    $("#hid_solutionId").val(row.SolutionId);
                    edit_set(row);
                },
                columns: [[
                    { field: 'CK', title: '', checkbox: true },
                    { field: 'SetId', title: '集合编号', width: 60 },
                    { field: 'SetName', title: '集合名称', width: 100, align: 'center' },
                    { field: 'SolutionId', title: '方案编号', width: 80, align: 'center' },
                    { field: 'WidgetId', title: '小部件', width: 80, align: 'center', formatter: easyuigrid_ajaxFormatter, vals: widgetId },
                    { field: 'WidgetOption', title: '小部件设置', width: 200, align: 'center' },
                    { field: 'Status', title: '状态', width: 80, align: 'center', formatter: easyuigrid_statusFormatter }
            ]],
                loader: easyuiLoader
            })).datagrid('getPager').pagination({ displayMsg: '显示 第 {from} 到 {to} 共 {total} 条' });

            setGridrowColor();
        }); //end loadTree
    });

    /*************方案****************/
    function add_solution() {
        if (models[currentMenuCode].onBeforeDialogOpen) {
            if (_.isFunction(models[currentMenuCode].onBeforeDialogOpen)) {
                models[currentMenuCode].onBeforeDialogOpen.apply(this, []);
            }
        }
        getJQO('#' + models[currentMenuCode].dialogId).dialog(_.extend({
            inline: false,
            onClose: function () {
                models[currentMenuCode].uiMode = 'list';
            },
            modal: true
        }, models[currentMenuCode].dialogOption)).dialog('open').dialog('setTitle', '新增' + models[currentMenuCode].entityName);
        getJQO('#' + models[currentMenuCode].formId).form('clear');
        models[currentMenuCode].uiMode = 'add';
    }

    function edit_solution(rows) {
        var row = rows;
        if (!row) {
            //row = $('#dg-B11040604').datagrid('getSelected');//用树替换grid
            row= $("#" + models[currentMenuCode].treeId).tree("getSelected");
        }
        if (row) {
            if (models[currentMenuCode].onBeforeDialogOpen) {
                if (_.isFunction(models[currentMenuCode].onBeforeDialogOpen)) {
                    models[currentMenuCode].onBeforeDialogOpen.apply(this, [row]);
                }
            }
            var url;
            if (models[currentMenuCode].baseEditModelUrl) {
                if (_.isFunction(models[currentMenuCode].baseEditModelUrl)) {
                    url = models[currentMenuCode].baseEditModelUrl();
                }
                else {
                    url = models[currentMenuCode].baseEditModelUrl;
                }
            }
            else {
                url = models[currentMenuCode].baseModelUrl;
            }
            //url = url + row[models[currentMenuCode].pk];
            url = url + row.id;
            getTo(url, null, null, null, null).done(function (ret) {             
                getJQO('#' + models[currentMenuCode].formId).form('clear');
                getJQO('#' + models[currentMenuCode].formId).form('load', ret.instance);
                getJQO('#' + models[currentMenuCode].dialogId).dialog(_.extend({
                    onClose: function () {
                        models[currentMenuCode].uiMode = 'list';
                    },
                    modal: true
                }, null)).dialog('open').dialog('setTitle', '编辑' + models[currentMenuCode].entityName);
            });
            models[currentMenuCode].uiMode = 'edit'; 
        } else {
            alertInfo("选择需要修改的方案");
        }
    }

    function save_solution() {
        var formData = $('#' + models[currentMenuCode].formId).serializeObject();
        if (models[currentMenuCode].changeFormDataBeforeSubmit) {
            if (_.isFunction(models[currentMenuCode].changeFormDataBeforeSubmit)) {
                models[currentMenuCode].changeFormDataBeforeSubmit.apply(null, [formData]);
            }
        }
        formData.PK = getJQO('#' + models[currentMenuCode].pkId).val();
        var isCreate;
        isCreate = models[currentMenuCode].uiMode == 'add';
        formData.isCreate = isCreate;
        action = isCreate ? "insert" : "update";
        saveTo(models[currentMenuCode].baseModelUrl, $.extend(models[currentMenuCode].defaultModel || {}, formData), function (ret) {
            $('#' + models[currentMenuCode].dialogId).dialog('close');
            treeRefresh();
            models[currentMenuCode].uiMode = 'list';
            alertInfo((isCreate ? '新增' : '编辑') + '成功！');
        }, null);
    }

    function nullify_solution() {
        var action = 'nullify';
        var actionName = "作废";
        //var rows = getJQO('#' + models[currentMenuCode].gridId).datagrid('getSelections');//用树代替grid
        var rows = $("#" + models[currentMenuCode].treeId).tree("getChecked");
        if (rows.length > 0) {
            alertConfirm('确定要' + actionName + '选中记录吗？', function (r) {
                if (r) {
                    var pks = _.map(rows, function (o) {
                        return o.id;
                    });
                    var selected = pks.join('|');
                    var fn = function () {
                        treeRefresh();
                        models[currentMenuCode].uiMode = 'list';
                        alertInfo(actionName + '成功！');
                    };
                    nullifyTo2(models[currentMenuCode].baseModelUrl, selected, fn, null);
                }
            });
        }
        else {
            alertInfo('请选中要' + actionName + '的方案！');
        }
    }
    /***********集****************/
    function query_set() {
        var node = $('#' + models[currentMenuCode].treeId).tree('getSelected');
        var state = $("#queryState").combobox("getValue");
        var params=[];
        if (node) {
            if (state == "normal") {
               $('#' + models[currentMenuCode].gridId2).datagrid({ url: models[currentMenuCode].baseModelUrl2 + 'ListForEasyUIgrid'
            , queryParams: {
                    sort: 'OperatedOn',
                    order: 'desc',
                    instance: {
                        'Status': 1,
                        'SolutionId': node.id
                    }
                }
            });
            }else{
                $('#' + models[currentMenuCode].gridId2).datagrid({ url: models[currentMenuCode].baseModelUrl2 + 'ListForEasyUIgrid'
            , queryParams: {
                    sort: 'OperatedOn',
                    order: 'desc',
                    instance: {
                        'Status': 0,
                        'SolutionId': node.id
                    }
                }
            });
            }
        }
    }

    function add_set() {
        var sid = $("#hid_solutionId").val();
        if (sid == "" || sid == null) {
            alertError("请先选择方案!");
            return;    
        }
        if (models[currentMenuCode].onBeforeDialogOpen2) {
            if (_.isFunction(models[currentMenuCode].onBeforeDialogOpen2)) {
                models[currentMenuCode].onBeforeDialogOpen2.apply(null, []);
            }
        }
        getJQO('#' + models[currentMenuCode].dialogId2).dialog(_.extend({
            inline: false,
            onClose: function () {
                models[currentMenuCode].uiMode = 'list';
            },
            modal: true
        }, null)).dialog('open').dialog('setTitle', '新增' + models[currentMenuCode].entityName2);
        getJQO('#' + models[currentMenuCode].formId2).form('clear');

        if (models[currentMenuCode].getPKValueWhenAdd) {
            getJQO('#' + models[currentMenuCode].pkId2).val(models[currentMenuCode].getPKValueWhenAdd(true));
        }
        else {
            getJQO('#' + models[currentMenuCode].pkId2).val("");
        }

        models[currentMenuCode].uiMode = 'add';

        if (models[currentMenuCode].onAfterDialogOpen2) {
            if (_.isFunction(models[currentMenuCode].onAfterDialogOpen2)) {
                models[currentMenuCode].onAfterDialogOpen2.apply(this, []);
            }
        }
    }

    function edit_set(rows) {
        var row = rows;
        if (!row) {
            row = $('#' + models[currentMenuCode].gridId2).datagrid('getSelected');
        }
        if (row) {
            if (models[currentMenuCode].onBeforeDialogOpen2) {
                if (_.isFunction(models[currentMenuCode].onBeforeDialogOpen2)) {
                    models[currentMenuCode].onBeforeDialogOpen2.apply(null, [row]);
                }
            }
            var url;
            if (models[currentMenuCode].baseEditModelUrl2) {
                if (_.isFunction(models[currentMenuCode].baseEditModelUrl2)) {
                    url = models[currentMenuCode].baseEditModelUrl2();
                }
                else {
                    url = models[currentMenuCode].baseEditModelUrl2;
                }
            }
            else {
                url = models[currentMenuCode].baseModelUrl2;
            }

            url = url + row[models[currentMenuCode].pk2];
            //
            getTo(url, null, null, null, null).done(function (ret) {
                getJQO('#' + models[currentMenuCode].formId2).form('clear');
                getJQO('#' + models[currentMenuCode].formId2).form('load', ret.instance);
             
                getJQO('#' + models[currentMenuCode].dialogId2).dialog(_.extend({
                    onClose: function () {
                        models[currentMenuCode].uiMode = 'list';
                    },
                    modal: true
                }, models[currentMenuCode].dialogOption)).dialog('open').dialog('setTitle', '编辑' + models[currentMenuCode].entityName2);
                if (models[currentMenuCode].disabled) {
                    getJQO('#' + models[currentMenuCode].pkId2).attr("disabled", _.any(models[currentMenuCode].disabled, 'edit'));
                }

                if (models[currentMenuCode].onAfterDialogOpen2) {
                    if (_.isFunction(models[currentMenuCode].onAfterDialogOpen2)) {
                        models[currentMenuCode].onAfterDialogOpen2.apply(null, [row]);
                    }
                }
            });
            models[currentMenuCode].uiMode = 'edit';
        } else {
            alertInfo("选择需要修改的集合");
        }
    }

    function nullify_set() {
        var action = 'nullify';
        var actionName = "作废";
        var rows = getJQO('#' + models[currentMenuCode].gridId2).datagrid('getSelections');
        if (rows.length > 0) {
            alertConfirm('确定要' + actionName + '选中记录吗？', function (r) {
                if (r) {
                    var pks = _.map(rows, function (o) {
                        return o[models[currentMenuCode].pk2];
                    });
                    var selected = pks.join('|');

                    var url;
                    if (models[currentMenuCode].baseEditModelUrl2) {
                        if (_.isFunction(models[currentMenuCode].baseEditModelUrl2)) {
                            selected = (models[currentMenuCode].baseEditModelUrl2() + pks.join('|')).replace(models[currentMenuCode].baseModelUrl2, '');
                        }
                        else {
                            selected = (models[currentMenuCode].baseEditModelUrl2 + pks.join('|')).replace(models[currentMenuCode].baseModelUrl2, '');
                        }
                    }
                    var fn = function () {
                        getJQO('#' + models[currentMenuCode].gridId2).datagrid('reload');
                        models[currentMenuCode].uiMode = 'list';
                        alertInfo(actionName + '成功！');
                    };
                    nullifyTo2(models[currentMenuCode].baseModelUrl2, selected, fn, null);
                }
            });
        }
        else {
            alertInfo('请选中要' + actionName + '的记录！');
        }
    }

    function save_set() {
        var action;
        if (getJQO('#' + models[currentMenuCode].formId2).form('validate')) {
            var formData = getJQO('#' + models[currentMenuCode].formId2).serializeObject();
         
            formData.PK = getJQO('#' + models[currentMenuCode].pkId2).val();
            var isCreate;
            isCreate = models[currentMenuCode].uiMode == 'add';
            formData.isCreate = isCreate;
            action = isCreate ? "insert" : "update";

            var url = models[currentMenuCode].baseModelUrl2;
            
            if (models[currentMenuCode].changeFormDataBeforeSubmit2) {
                models[currentMenuCode].changeFormDataBeforeSubmit2(formData);
            }
            saveTo(url, $.extend(models[currentMenuCode].defaultModel || {}, formData), function (ret) {
                getJQO('#' + models[currentMenuCode].dialogId2).dialog('close');
                getJQO('#' + models[currentMenuCode].gridId2).datagrid(isCreate ? 'load' : 'reload');

                models[currentMenuCode].uiMode = 'list';
                alertInfo((isCreate ? '新增' : '编辑') + '成功！');
            }, null);
        }
    }

    function add_subSet() {
        var now = new Date().getTime();
        var row = $('#' + models[currentMenuCode].gridId2).datagrid('getSelected');
        if (row) {
            top.openTab("UD213_" + now, "B11040605", row.SetName+"_"+row.SetId + "子集及列", "views/set-manage/subSetAndColumn.htm?SetId=" + row.SetId, null, null, true, true, null, false);
        } else {
            alertInfo("请选择需要添加的集合");
        }
    }

    function treeRefresh() {
        var node = $("#" + models[currentMenuCode].treeId).tree("getSelected");
        refreshTree("easyUITree", models[currentMenuCode].treeId, '01$03$03', null, '{ "Level": "0","WhereClause":" where level=0" }');
        if (node) {
            $("#" + models[currentMenuCode].treeId).tree("select", node.target);
        }
    }

    function cancel_set() {
        getJQO('#' + models[currentMenuCode].dialogId2).dialog('close');
    }

    function setGridrowColor(){
        $('#' + models[currentMenuCode].gridId2).datagrid({
            rowStyler: function (index, row) {
                if (row.Status == 0) {
                    return 'background-color:#FF6347;';
                }
            }
        });
    }

    function query_btn() { 
        var state = $("#queryState").combobox("getValue");
        var solutionId=$("#hid_solutionId").val();
        var queryParams;
        if(solutionId!=""){
            if (state == "normal") {
                queryParams = {
                    sort: 'OperatedOn',
                    order: 'desc',
                    instance: {
                        'Status': 1,
                        'SolutionId': solutionId
                    }
                };
            } else if (state == "revoked") {
                queryParams = {
                    sort: 'OperatedOn',
                    order: 'desc',
                    instance: {
                        'Status': 0,
                        'SolutionId': solutionId
                    }
                };
            }
        }
        getJQO('#' + models[currentMenuCode].gridId2).datagrid('load', queryParams);
    }
</script>
